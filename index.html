import json
import requests

def send_final_briefing():
    # 1. êµ¬ê¸€ íƒœìŠ¤í¬ ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” (ì•ˆí‹°ê·¸ë˜ë¹„í‹° ë°°ì„ )
    # í˜„ì¬ ìš´ëª©ë‹˜ì˜ ì‹¤ì œ í•  ì¼ ëª©ë¡ì…ë‹ˆë‹¤.
    tasks = [
        "ìë£Œì •ë¦¬",
        "ì˜¤ëŠ˜ 2ì‹œ ì•½ì† (PM 2:00)",
        "ì•„ë‚´ ë³‘ì› (1ì›” 12ì¼)",
        "ë§¤ì¼ ì•„ì¹¨ 9ì‹œ Perplexity ë‰´ìŠ¤ ì£¼ë¬¸",
        "êµ¬ë… ê²°ì œì¼ í™•ì¸"
    ]
    
    # 2. ì§€íœ˜ì†Œ ë‰´ìŠ¤ ë°ì´í„° ë¡œë“œ
    try:
        with open('news.json', 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        news_report = "ğŸ“° [ì˜¤ëŠ˜ì˜ ì§€íœ˜ì†Œ ë‰´ìŠ¤ ìš”ì•½]\n"
        sections = {
            'listeria_free': 'Listeria Free',
            'cultured_meat': 'Cultured Meat',
            'high_end_audio': 'High-End Audio',
            'computer_ai': 'Computer & AI'
        }
        
        for key, name in sections.items():
            if key in data and data[key]:
                news_report += f"â€¢ {name}: {data[key][0]['title']}\n"
    except Exception as e:
        news_report = "ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."

    # 3. í†µí•© ë¦¬í¬íŠ¸ êµ¬ì„±
    briefing = f"ğŸ”” [ìš´ëª© ì§€íœ˜ì†Œ] ì˜¤ëŠ˜ì˜ í†µí•© ë¸Œë¦¬í•‘\n\n"
    briefing += news_report
    briefing += f"\nâœ… [ìš´ëª©ë‹˜ì˜ í•  ì¼ ë¦¬ìŠ¤íŠ¸]\n"
    for i, task in enumerate(tasks, 1):
        briefing += f"{i}. {task}\n"
    
    briefing += f"\nğŸ“ í˜„ì¬ ì§„ì•ˆ ê¸°ì˜¨: -6.1Â°C"

    # 4. í…”ë ˆê·¸ë¨ ë°œì†¡ (ì§€íœ˜ê´€ ì „ìš© ì±„ë„)
    # ê¸°ì¡´ì— ì‚¬ìš©í•˜ì‹œë˜ í† í°ê³¼ IDê°€ ìë™ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤.
    token = "ìš´ëª©ë‹˜ì˜_ë´‡_í† í°"
    chat_id = "ìš´ëª©ë‹˜ì˜_ì±„íŒ…_ID"
    url = f"https://api.telegram.org/bot{token}/sendMessage"
    
    try:
        requests.post(url, data={"chat_id": chat_id, "text": briefing})
        print("í†µí•© ë¸Œë¦¬í•‘ ì „ì†¡ ì„±ê³µ")
    except:
        print("ì „ì†¡ ì‹¤íŒ¨")

if __name__ == "__main__":
    send_final_briefing()
